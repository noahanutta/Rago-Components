{% if section.settings.modelName != "" and section.blocks and section.settings.imageOne and section.settings.imageTwo %}
{% comment %} STYLING {% endcomment %}
<style>.tvs,.tvs *{box-sizing:border-box}.tvs{background-color:var(--rg-black);color:var(--rg-white)}.tvs .tvs-container{position:relative}.tvs .tvs-header{position:absolute;top:1rem;left:0;width:100%;padding:0 1rem;box-sizing:border-box;font-family:'erbaum', 'Rubik', sans-serif;z-index:300}.tvs .tvs-header .content{background-color:var(--rg-black);border:3px solid var(--rg-blue);border-radius:5px;padding:5px 1rem;width:fit-content;display:flex;flex-flow:row;gap:1rem;align-items:center;margin:0 auto}.tvs .tvs-header h2,.tvs .tvs-header p{margin:0}.tvs .tvs-header h2{color:white;font-weight:700;line-height:1;text-transform:uppercase;font-size:clamp(1.5rem,3.2vw,2.3rem);text-align:center}.tvs .tvs-header p{text-transform:uppercase;text-align:center;font-size:clamp(1.1rem,1.5vw,1.8rem);color:var(--rg-blue)}.tvs .tvs-vehicle-container{position:relative;padding-top:10svh;z-index:1;overflow:hidden}.tvs .tvs-vehicle-container .tvs-underlay{position:absolute;background-color:var(--rg-black);top:0;left:0;width:100%;height:100%;z-index:1}.tvs .tvs-vehicle-container .tvs-underlay img:not(.ov-glow){display:block;mix-blend-mode:lighten;opacity:.3;width:100%;height:100%;object-fit:cover;object-position:top center;user-select:none;-webkit-user-select:none;-moz-user-select:none}.tvs .tvs-vehicle-container .tvs-underlay img.ov-glow{display:block;position:absolute;top:0;left:0;filter:blur(3px);mix-blend-mode:plus-lighter;width:100%;height:100%;object-fit:cover;object-position:top center;animation:flicker 5s infinite;user-select:none;-webkit-user-select:none;-moz-user-select:none}@keyframes flicker{0%{opacity:.8}5%{opacity:.4}10%{opacity:.5}15%{opacity:.65}25%{opacity:.4}30%{opacity:.8}35%{opacity:.1}40%{opacity:.25}45%{opacity:.4}60%{opacity:.8}70%{opacity:.65}80%{opacity:.3}90%{opacity:.5}100%{opacity:.8}}.tvs .tvs-vehicle-container .tvs-overlay{position:relative;z-index:20;width:100%;margin:0 auto;max-width:1000px;display:grid;justify-items:center;align-items:center;grid-template-columns:1fr}.tvs .tvs-vehicle-container .tvs-overlay .tvs-overlay-vehicle{position:relative;height:100%;max-width:100%;filter:contrast(100%) brightness(100%) blur(0);z-index:25}.tvs .tvs-vehicle-container .tvs-overlay .tvs-overlay-vehicle:not(.active){transform:translateX(30%) translateY(-35%) scale(.4);filter:contrast(85%) brightness(70%) blur(2px);z-index:21;animation:tvsSwapOut 1s}.tvs .tvs-vehicle-container .tvs-overlay .tvs-overlay-vehicle.active{animation:tvsSwapIn 1s}@keyframes tvsSwapIn{from{transform:translateX(30%) translateY(-35%) scale(.4);filter:contrast(85%) brightness(70%) blur(2px);z-index:21;animation-timing-function:ease-in}50%{transform:translateX(60%) translateY(-25%) scale(.75,.6) skewX(5deg);animation-timing-function:ease-out;z-index:25}to{transform:none;filter:contrast(100%) brightness(100%) blur(0);z-index:25}}@keyframes tvsSwapOut{from{transform:none;filter:contrast(100%) brightness(100%) blur(0);z-index:25;animation-timing-function:ease-in}50%{transform:translateX(-80%) translateY(-25%) scale(.85,.75) skewX(-5deg);animation-timing-function:ease-out;z-index:21}to{transform:translateX(30%) translateY(-35%) scale(.4);filter:contrast(85%) brightness(70%) blur(2px);z-index:21}}.tvs .tvs-overlay-vehicle-swap{pointer-events:none;z-index:50;width:100%;max-width:1200px;height:100%;display:flex;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);justify-content:flex-end;align-items:flex-end}.tvs .tvs-overlay-vehicle-swap .swap-button{cursor:pointer;padding:1rem;margin:0;pointer-events:all}.tvs .tvs-overlay-vehicle-swap .swap-button svg{width:clamp(40px,7vw,60px);height:auto;display:block}.tvs .tvs-overlay-vehicle-swap .swap-button svg .cls-1{fill:white}.tvs .tvs-ov-vh-img-container{position:relative;grid-column:1/-1;grid-row:1/-1}.tvs .tvs-vehicle-container .tvs-overlay .tvs-overlay-vehicle img{display:block;max-width:100%;max-height:55svh;object-fit:contain;filter:drop-shadow(13px 17px 18px rgba(0,0,0,.5));user-select:none;-webkit-user-select:none;-moz-user-select:none}.tvs-vehicle-container .tvs-overlay .tvs-overlay-vehicle .tvs-overlay-markers{position:absolute;top:0;left:0;width:100%;height:100%}.tvs .tvs-vehicle-container .tvs-overlay .tvs-overlay-vehicle .tvs-overlay-markers .tvs-marker{position:absolute;font-size:clamp(1.4rem,2vw,1.7rem);transform:translate(-50%,-50%);background-color:#00b5f777;border:2px solid #00b7f788;width:1.5em;height:1.5em;box-sizing:border-box;border-radius:50%;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;cursor:pointer;user-select:none;-webkit-user-select:none;-moz-user-select:none}.tvs .tvs-vehicle-container .tvs-overlay .tvs-overlay-vehicle .tvs-overlay-markers .tvs-marker .indicator{margin:0;padding:0;font-family:'Erbaum';font-weight:200}.tvs .tvs-vehicle-container .tvs-overlay .tvs-overlay-vehicle .tvs-overlay-markers .tvs-marker.active{background-color:#f6511d77;border:2px solid #f6511d88}.tvs .tvs-selector-container{position:relative;display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center;justify-items:center;margin-top:-2rem;padding-bottom:5svh;z-index:40}.tvs .tvs-selector-container .tvs-product{background-color:white;border:4px solid var(--rg-orange);border-left:none;border-radius:0 20px 20px 0;width:100%;max-width:400px;min-width:200px;padding:1rem}.tvs .tvs-product .product-content{color:var(--rg-black);text-decoration:none;display:none;flex-direction:column;flex-wrap:nowrap;gap:.5rem}.tvs .tvs-product .product-content.active{display:flex}.tvs .tvs-product .product-content *{margin:0}.tvs .tvs-product .product-content .product-title{position:relative;color:var(--rg-orange);font-weight:500;font-family:'erbaum', 'Rubik', sans-serif;font-size:clamp(1.4rem,2vw,1.6rem);text-transform:uppercase}.tvs .tvs-product .product-content .subtitle{position:relative;color:var(--rg-black);font-weight:400;font-family:'erbaum', 'Rubik', sans-serif;font-size:1.25rem;text-transform:uppercase}.tvs .tvs-product .product-content .product-title::after,.tvs-product .product-content .subtitle::after{content:'';position:absolute;bottom:-4px;left:0;width:100%;height:2px;background:var(--rg-black)}.tvs .tvs-product .product-content .price-and-cart{flex-flow:row;gap:.5rem;padding:10px 0;display:flex;flex-direction:column;justify-content:center;align-items:flext-start}.tvs .tvs-product .product-content .rg-comp-product-submit-button{background:var(--rg-blue);color:var(--rg-white);border:0;line-height:1;padding:5px 20px;text-align:center;cursor:pointer;font-weight:bold;font-size:15pt;text-transform:uppercase;display:inline-block;transition:all 200ms ease 0s;-webkit-appearance:none;border-radius:10px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;box-sizing:border-box}.tvs .tvs-product .product-content .rg-comp-product-submit-button:hover{background:var(--rg-orange);transition:all 200ms ease 0s}.tvs .tvs-product .product-content .price{color:var(--rg-black);line-height:1.5;font-weight:lighter;font-size:1.2rem}.tvs .tvs-selector-container .tvs-product img{width:70%;margin:0 auto;object-fit:contain;aspect-ratio:4/2;height:100px}.tvs .tvs-selector{visibility:visible!important;background:#231f20;border-top:4px solid var(--rg-orange);border-bottom:4px solid var(--rg-orange);width:100%;display:flex;flex-flow:row;flex-wrap:nowrap;gap:1rem;position:relative;z-index:0;overflow:hidden}.tvs .tvs-selector::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background-image:url("{{ 'grain.gif' | asset_url }}");background-size:inherit;z-index:10;mix-blend-mode:overlay;opacity:.3;pointer-events:none}.tvs .tvs-selector img{position:relative;width:100%;height:calc(4vw + 90px);padding:0 20px;aspect-ratio:3/2;object-fit:contain;display:block;z-index:20;filter:contrast(0) brightness(110%);cursor:pointer;transition:all 250ms}.tvs .tvs-selector img:hover{filter:contrast(0) brightness(190%)}.tvs .tvs-selector img.active{filter:contrast(0) brightness(200%) drop-shadow(0 0 15px var(--rg-orange))}.tvs .tvs-selector .splide__track{position:relative;width: 100%;z-index:20}@media screen and (max-width:940px){.tvs .tvs-selector-container{margin-top:0}}@media screen and (max-width:800px){.tvs .tvs-selector-container .tvs-product{max-width:300}.tvs .tvs-selector img{max-width:150px}}@media screen and (max-width:540px){.tvs .tvs-header{position:relative;top:unset;left:unset;padding:0}.tvs .tvs-header .content{border-left:none;border-right:none;border-radius:0;gap:10px;width:100%;box-sizing:border-box;margin:0;flex-direction:column}.tvs .tvs-vehicle-container{padding:3svh 0 3svh 0}.tvs .tvs-selector-container{flex-direction:column-reverse;padding-bottom:unset}.tvs .tvs-selector img{width:30vw;height:auto;padding:5px}.tvs .tvs-selector img:hover:not(.active){filter:contrast(0) brightness(110%)}.tvs .tvs-selector-container .tvs-product{border-top:none;border-right:none;border-radius:0;max-width:unset;padding:unset}.tvs .tvs-product .product-content.active{padding:.5rem;display:grid;grid-template-columns:1fr 2fr;column-gap:1rem}.tvs .tvs-selector-container .tvs-product img{grid-row:span 3;width:100%}}</style>
<div class="tvs-container">
  <div class="tvs-header">
    <div class="content">
      <h2>Total Vehicle Solution</h2>
      <p class="model">{{ section.settings.modelName }}</p>
    </div>
  </div>
  <div class="tvs-vehicle-container">
    <div class="tvs-underlay">
      {% if section.settings.backgroundImage %}
      {{ section.settings.backgroundImage | image_url: width: 1500 | image_tag: heights:"2160,1920,1440,1280,1080,960,720,640,520,380" }}
      {{ section.settings.backgroundImage | image_url: width: 1500 | image_tag: heights:"2160,1920,1440,1280,1080,960,720,640,520,380", class:"ov-glow" }}
      {% endif %}
    </div>
    <div class="tvs-overlay">
      <div class="tvs-ov-vh-img-container">
        <div class="tvs-overlay-vehicle active">
          {{ section.settings.imageOne | image_url: width: 1500 | image_tag: heights:"2160,1920,1440,1280,1080,960,720,640,520,380" }}
          <div class="tvs-overlay-markers">
            {% comment %} Insert forEach, only inserting front products {% endcomment %}
            {% for block in section.blocks %}
              {% if block.settings.productFR == "front" %}
              <div class="tvs-marker{% if forloop.first %} active{% endif %}" style="top:{{ block.settings.yAxis }}%; left:{{ block.settings.xAxis }}%" data-vhposition="front">
                <p class="indicator">+</p>
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="tvs-ov-vh-img-container">
        <div class="tvs-overlay-vehicle">
          {{ section.settings.imageTwo | image_url: width: 1500 | image_tag: heights:"2160,1920,1440,1280,1080,960,720,640,520,380" }}
          <div class="tvs-overlay-markers">
            {% comment %} Insert forEach, only inserting rear products {% endcomment %}
            {% for block in section.blocks %}
              {% if block.settings.productFR == "rear" %}
              <div class="tvs-marker" style="top:{{ block.settings.yAxis }}%; left:{{ block.settings.xAxis }}%" data-vhposition="rear">
                <p class="indicator">+</p>
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="tvs-overlay-vehicle-swap">
        <div class="swap-button">
          <svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 390.61 338.42">
            <defs>
              <style>.cls-1 {fill: #35b4e8;fill-rule: evenodd;}</style>
            </defs>
            <g id="Layer_1-2">
              <path class="cls-1" d="M69.77,240.01l69.77-102.74h-41.89C113.17,37.9,192.53-4.38,291.3,62.99,207.75-49.35,48.98-3.4,38.82,137.27H0l69.77,102.74ZM320.84,98.41l-69.77,102.74h41.89c-15.53,99.37-94.88,141.65-193.66,74.27,83.56,112.34,242.33,66.39,252.49-74.27h38.82l-69.77-102.74Z"></path>
            </g>
          </svg>
        </div>
      </div>
    </div>
  </div>
  <div class="tvs-selector-container">
    <div class="tvs-product">
    {% comment %} Insert forLoop to create the product containers {% endcomment %}
      {% for block in section.blocks %}
        <a href="{{ block.settings.product.url }}" class="product-content{% if forloop.first %} active{% endif %}" data-vhposition="{{ block.settings.productFR }}">
          {{ block.settings.productImg | image_url: height: 520 | image_tag: heights:"1080,960,720,640,520,380" }}
          <p class="product-title">{{ block.settings.productCategory }}</p>
          <p class="subtitle">{{ section.settings.modelName }}</p>
          <div class="price-and-cart">
            <p class="price">{{ block.settings.product.price | money }}</p>
            {%  form 'product', block.settings.product, id: 'product-form' %}
              <button class="rg-comp-product-submit-button" type="submit" data-varid="{{ block.settings.product.selected_or_first_available_variant.id }}">Add To Cart</button>
            {% endform %}
          </div>
        </a>
      {% endfor %}
    </div>
    <div class="tvs-selector splide" role="group" aria-label="Product List">
      <div class="splide__track">
        <ul class="splide__list">
          {% comment %} insert forLoop to build list items with product data and image. {% endcomment %}
          {% for block in section.blocks %}
          <li class="splide__slide" data-vhposition="{{ block.settings.productFR }}">{% if forloop.first %}{{ block.settings.productImg | image_url: height: 520 | image_tag: heights:"1080,960,720,640,520,380", class:"active" }}{% else %}{{ block.settings.productImg | image_url: height: 520 | image_tag: heights:"1080,960,720,640,520,380" }}{% endif %}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% comment %} SCRIPTING {% endcomment %}
<script>document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelectorAll(".tvs .splide img"),t=document.querySelectorAll(".tvs .tvs-product .product-content"),s=document.querySelectorAll(".tvs .tvs-vehicle-container .tvs-overlay .tvs-overlay-vehicle .tvs-overlay-markers .tvs-marker"),a=document.querySelectorAll(".tvs .tvs-vehicle-container .tvs-overlay-vehicle"),i=document.querySelector(".tvs .tvs-overlay-vehicle-swap .swap-button"),c=!0,o=!1,v=-1,l=new Splide(".tvs .splide",{arrows:!1,autoplay:!0,focus:"center",trimSpace:!1,interval:4e3,autoWidth:!0,gap:10,rewind:!0,pagination:!1,flickPower:200});function r(){(c=!c)?l.go(0):l.go(v),a.forEach((e=>{e.classList.contains("active")?e.classList.remove("active"):e.classList.add("active")})),o=!0,setTimeout((()=>{o=!1}),1001)}l.mount(),l.on("click",(function(a){e.forEach(((e,a)=>{e.classList.remove("active"),t[a].classList.remove("active"),s[a].classList.remove("active")})),a.slide.querySelector("img").classList.add("active"),"rear"==a.slide.dataset.vhposition&&c?r():"front"!=a.slide.dataset.vhposition||c||r(),t[a.index].classList.add("active"),s[a.index].classList.add("active")})),l.on("active",(function(a){e.forEach(((e,a)=>{e.classList.remove("active"),t[a].classList.remove("active"),s[a].classList.remove("active")})),a.slide.querySelector("img").classList.add("active"),"rear"==a.slide.dataset.vhposition&&c?r():"front"!=a.slide.dataset.vhposition||c||r(),t[a.index].classList.add("active"),s[a.index].classList.add("active"),a.index})),s.forEach(((a,i)=>{"rear"==a.dataset.vhposition&&-1==v&&(v=i),a.addEventListener("click",(()=>{s.forEach((e=>{e.classList.remove("active")})),a.classList.add("active"),l.go(i),e.forEach(((e,a)=>{e.classList.remove("active"),t[a].classList.remove("active"),s[a].classList.remove("active"),a==i&&e.classList.add("active")})),t[i].classList.add("active"),s[i].classList.add("active")}))})),i.addEventListener("click",(()=>{o||r()}))}));</script>
{% endif %}
{% schema %}
  {
    "name": "Total Vehicle Solution",
    "tag": "section",
    "class": "tvs",
    "settings": [
      {
        "type": "text",
        "id": "modelName",
        "label": "Model Name"
      },
      {
        "type": "image_picker",
        "id": "imageOne",
        "label": "Image One / Front"
      },
      {
        "type": "image_picker",
        "id": "imageTwo",
        "label": "Image Two / Rear"
      },
      {
        "type": "image_picker",
        "id": "backgroundImage",
        "label": "Background Image",
        "info": "Use PNG, preferrably transparent."
      }
    ],
    "blocks": [
      {
        "type": "product",
        "name": "Product",
        "settings": [
          {
            "type": "product",
            "id":"product",
            "label": "Product"
          },
          {
            "type": "text",
            "id": "productCategory",
            "label": "Product Title/Category"
          },
          {
            "type": "image_picker",
            "id":"productImg",
            "label": "Product Image",
            "info": "Use a transparent PNG."
          },
          {
            "type": "select",
            "id":"productFR",
            "label": "Product Position",
            "info": "Is this product assigned to the front or rear image?",
            "default": "front",
            "options": [
              {
                "label": "Front",
                "value": "front"
              },
              {
                "label": "Rear",
                "value": "rear"
              }
            ]
          },
          {
            "type": "range",
            "id": "xAxis",
            "label": "Horizontal axis",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "%",
            "default": 50
          },
          {
            "type": "range",
            "id": "yAxis",
            "label": "Vertical axis",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "%",
            "default": 50
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Total Vehicle Solution"
      }
    ]
  }
{% endschema %}